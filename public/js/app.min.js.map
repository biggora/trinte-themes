{"version":3,"sources":["app.js"],"names":["Application","Core","this","pathname","window","location","origin","csrf_token","$","attr","csrf_param","prototype","buildModal","el","opts","app","title","body","btnText","template","modal","action","templates","find","uri","pathC","split","model","length","id","html","replace","click","e","callRemote","on","unbind","method","url","dataType","undefined","triggerAndReturn","data","is","serializeArray","found","i","name","push","value","ajax","type","toUpperCase","beforeSend","xhr","trigger","success","status","eval","complete","error","jsonp","bind","preventDefault","menuActivator","urlRegExp","RegExp","each","self","test","parent","addClass","typeahead","tphInput","dataUrl","dataField","singularUrl","onSelect","item","timeout","displayField","triggerLength","loadingClass","preDispatch","query","search","preProcess","setTimeout","css","width","parseInt","items","start","fn","extend","event","Event","result","App"],"mappings":"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","file":"app.min.js","sourcesContent":["\nvar Application = Application || {};\n\n/**\n * Application class.\n * @constructor\n */\nApplication.Core = function() {\n    this.pathname = window.location.pathname;\n    this.origin = window.location.origin;\n    this.csrf_token = $('meta[name=x-csrf-token]').attr('content');\n    this.csrf_param = $('meta[name=x-csrf-param]').attr('content');\n    return this;\n};\n\n/*\n * Build modal window\n */\nApplication.Core.prototype.buildModal = function(el, opts) {\n    var app = this, title = \"\", body = \"\", btnText = \"\", template = \"\";\n    var modal = $('#dialog-confirm');\n    if (opts) {\n        if (opts.action) {\n            var templates = $('#modal-templates'), template;\n            switch (opts.action) {\n                case 'delete':\n                    template = templates.find('.modal-delete');\n                    break;\n                case 'save':\n                    template = templates.find('.modal-save');\n                    break;\n            }\n            var uri = el.attr('href');\n            var pathC = uri.split('/') || [];\n            var model = pathC[pathC.length - 2] || '';\n            var id = pathC[pathC.length - 1] || '';\n            title = template.find('.header-text').html()\n                    .replace(/%s/gi, model)\n                    .replace(/%d/gi, id);\n            body = template.find('.body-text').html()\n                    .replace(/%s/gi, model)\n                    .replace(/%d/gi, id);\n            btnText = template.find('.btn-text').html()\n                    .replace(/%s/gi, model)\n                    .replace(/%d/gi, id);\n        } else {\n            title = opts.title || \"\";\n            body = opts.body || \"\";\n            btnText = opts.btnText || \"\";\n        }\n    }\n\n    modal.attr('title', title);\n    modal.find('#dialog-confirm-header').html(title);\n    modal.find('.modal-body').html(body);\n    modal.find('.btn-confirm-ok').click(function(e) {\n        app.callRemote(el);\n    }).html(btnText);\n    modal.on('hidden', function() {\n        modal.find('.btn-confirm-ok').unbind('click');\n    });\n    modal.modal('hide');\n    modal.modal('show');\n};\n\n/**\n * Handles execution of remote calls firing overridable events along the way\n * @param {Object} el\n */\nApplication.Core.prototype.callRemote = function(el) {\n    var app = this,\n            method = el.attr('method') || el.attr('data-method') || 'GET',\n            url = el.attr('action') || el.attr('href'),\n            dataType = el.attr('data-type') || 'script';\n\n    if (el.attr('data-jsonp')) {\n        dataType = 'text';\n    }\n\n    if (url === undefined) {\n        throw \"No URL specified for remote call (action or href must be present).\";\n    } else {\n        if (el.triggerAndReturn('ajax:before')) {\n            var data = el.is('form') ? el.serializeArray() : [];\n            var found = false;\n            for (var i = data.length - 1; i >= 0; i -= 1) {\n                if (data[i].name === app.csrf_param)\n                    found = true;\n            }\n            if (!found)\n                data.push({\n                    name: app.csrf_param,\n                    value: app.csrf_token\n                });\n            $.ajax({\n                url: url,\n                data: data,\n                dataType: dataType,\n                type: method.toUpperCase(),\n                beforeSend: function(xhr) {\n                    el.trigger('ajax:loading', xhr);\n                },\n                success: function(data, status, xhr) {\n                    if (el.attr('data-jsonp')) {\n                        eval(el.attr('data-jsonp') + '(' + data + ')');\n                    }\n                    el.trigger('ajax:success', [data, status, xhr]);\n                },\n                complete: function(xhr) {\n                    el.trigger('ajax:complete', xhr);\n                },\n                error: function(xhr, status, error) {\n                    el.trigger('ajax:failure', [xhr, status, error]);\n                }\n            });\n        }\n        el.trigger('ajax:after');\n    }\n};\n\n/**\n * Starts the rails.\n */\nApplication.Core.prototype.jsonp = function() {\n    var app = this;\n    $('a[data-remote]').bind('click', function(e) {\n        var el = $(this);\n        e.preventDefault();\n        if (el.attr('data-confirm')) {\n            app.buildModal(el, {\n                action: \"delete\"\n            });\n        } else {\n            app.callRemote(el);\n        }\n    });\n};\n\n/**\n * Starts the menu active.\n */\nApplication.Core.prototype.menuActivator = function() {\n    var app = this, url = app.pathname,\n            urlRegExp = new RegExp(url === '/' ? app.origin + '/?$' : url.replace(/\\/$/, ''));\n    $('.navbar-inner ul.nav li a').each(function(i) {\n        var self = $(this);\n        if (urlRegExp.test(self.attr('href').replace(/\\/$/, ''))) {\n            self.parent().addClass('active');\n        }\n    });\n};\n\n/**\n * Starts the typeahead.\n */\nApplication.Core.prototype.typeahead = function() {\n    var app = this;\n    var tphInput = $('input[data-provide=\"typeahead\"]');\n\n    if (tphInput.length) {\n        var dataUrl = tphInput.data('url');\n        var dataField = tphInput.data('field');\n        var singularUrl = tphInput.data('singular').replace('new', '');\n\n        tphInput.typeahead({\n            onSelect: function(item) {\n                window.location = singularUrl + '/' + item.value;\n            },\n            ajax: {\n                url: dataUrl + '.json',\n                method: \"GET\",\n                timeout: 300,\n                displayField: dataField,\n                triggerLength: 1,\n                loadingClass: 'ajax-loading',\n                preDispatch: function(query) {\n                    return {\n                        search: query\n                    };\n                },\n                preProcess: function(data) {\n                    if (data.success === false) {\n                        return false;\n                    }\n                    setTimeout(function() {\n                        $('ul.typeahead').css({\n                            width: parseInt(tphInput.width()) * 1.06\n                        });\n                    }, 5);\n                    var items = (data.items ? data.items : data);\n                    return items || [];\n                }\n            }\n        });\n    }\n};\n\n/**\n * Starts the Application.\n */\nApplication.Core.prototype.start = function() {\n    var app = this;\n    app.menuActivator();\n    app.jsonp();\n    app.typeahead();\n    return app;\n};\n\n$(function() {\n    $.fn.extend({\n        triggerAndReturn: function(name, data) {\n            var event = new $.Event(name);\n            this.trigger(event, data);\n\n            return event.result !== false;\n        }\n    });\n    var App = new Application.Core().start();\n    window.App = App;\n});"],"sourceRoot":"/source/"}